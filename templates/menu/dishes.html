{% extends 'default.html' %}

{% load custom_tags %}

{% block title %}
	Dishes
{% endblock title %}

{% block content %}
    <h2>Товары</h2>
    <hr>
	<!--  Добавляем форму, которая объединяет набор полей, которые будут отправляться в запросе -->
	<form enctype='multipart/form-data' action="" method="get">
		<!-- Форма для сортировки -->
		{{ form }}
		<input type="submit" value="Сортировать"><hr>
		<!-- Форма для фильтрации -->
		{{ filterset.form.as_p }}
		<input type="submit" value="Найти" /><hr>
		<button><a href="{% url 'dish_create' %}">Добавить товар</a></button>
	</form>

	{% if dishes %}
		<table cellpadding="10">
			<tr>
				<th>Фото</th>
				<th>Наименование</th>
				<th>Цена</th>
				<th>Количество</th>
				<th>В наличии</th>
			</tr>
			{% for dish in dishes %}
				<tr>
					{% if dish.picture %}
						<td><img src="{{ dish.picture.url }}" width="100"></td>
					{% else %}
						<td>Нет картинки</td>
					{% endif %}
					<td>{{ dish.name }}</td>
					<td>{{ dish.price_discount|floatformat:2 }} &#8381;</td>
					<td>{{ dish.quantity }} шт.</td>
					<td>{{ dish.is_in_stop_list|yesno:'Нет, Да' }}</td>
					{% if not dish.is_in_stop_list %}
					 	<td><button><a href="{% url 'dish_addsl' pk=dish.pk %}">Добавить в стоп-лист</a></button></td>
					{% else %}
						<td><button><a href="{% url 'dish_delsl' pk=dish.pk %}">Удалить из стоп-листа</a></button></td>
					{% endif %}
					<td><button><a href="{% url 'dish_detail' pk=dish.pk %}">Изменить</a></button></td>
					<td><button><a href="{% url 'dish_delete' pk=dish.pk %}">Удалить</a></button></td>
				</tr>
			{% endfor %}
		</table>
	{% else %}
		<p>Товаров нет!</p>
	{% endif %}
	<!-- Добавляем пагинацию на страницу -->
	<!-- Информация о предыдущих страницах -->
	{% if paginator.num_pages != 1 %}
		{% if page_obj.has_previous %}
			<a href="?{% url_replace page=1 %}">&laquo;Первая</a>
			...
			<a href="?{% url_replace page=page_obj.previous_page_number %}">{{ page_obj.previous_page_number }}</a>
		{% endif %}
		<!-- Информация о текущей странице -->
		|{{ page_obj.number }}|
		<!-- Информация о следующих страницах -->
		{% if page_obj.has_next %}
			<a href="?{% url_replace page=page_obj.next_page_number %}">{{ page_obj.next_page_number }}</a>
			...
			<a href="?{% url_replace page=page_obj.paginator.num_pages %}">Последняя&raquo;</a>
		{% endif %}
	{% endif %}

{% endblock content %}
